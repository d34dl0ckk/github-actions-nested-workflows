name: Belt

on:
  workflow_call:
    inputs:
      SUPPORTED_ARCH:
        required: true
        type: string
    outputs:
      matrix_tests:
        description: "matrix containing tests to run per architecture"
        value: ${{ jobs.pre_test.outputs.matrix_tests }}

jobs:
  pre_test:
    name: L1 prepping matrix
    strategy:
      matrix:
        arch: ${{ fromJson(inputs.SUPPORTED_ARCH) }}
    runs-on:
      - self-hosted
      - ${{ matrix.arch }}
    steps:
      - name: Create matrix
        id: prepare
        run: |
          echo "matrix_tests=[\"['aaa', 'bbb', 'ccc']\",\"['ddd', 'eee', 'fff']\"]" >> $GITHUB_OUTPUT
    outputs:
      matrix_tests: ${{ steps.prepare.outputs.matrix_tests }}
